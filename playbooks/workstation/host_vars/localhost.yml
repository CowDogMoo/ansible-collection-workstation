---
# Dynamic host_vars loader for localhost
# This file detects the actual hostname and loads the appropriate host-specific variables

# This will be evaluated at runtime and load the correct host-specific config
# The vars_files directive in a playbook would be better, but we can use
# group_vars/all.yml or handle this in the role itself

# For now, we'll use a simpler approach: check ansible_hostname and set variables accordingly
# This requires the role to be smart about loading, OR we make localhost.yml include the right file

# Unfortunately, host_vars doesn't support dynamic includes well.
# The cleanest solution is to make localhost.yml contain the logic to detect the hostname
# and set the appropriate variables

# We'll use YAML anchors and merge keys to avoid duplication
_git_hook_common: &git_hook
  event: PreToolUse
  tool: Bash
  type: command
  command: |
    python3 -c "
    import json, sys

    data = json.load(sys.stdin)
    cmd = data.get('tool_input', {}).get('command', '')

    forbidden = ['ü§ñ', 'Generated with', 'Co-Authored-By: Claude', 'claude.com/claude-code']

    msg = ''
    if 'git commit' in cmd and '-m' in cmd and any(f in cmd for f in forbidden):
        msg = '‚ùå BLOCKED: Forbidden content (emojis/branding)\\n\\n‚úÖ Use ONLY fabric output\\nGenerate: git diff --staged | fabric --pattern commit'
    elif 'gh pr create' in cmd and '--body' in cmd and any(f in cmd for f in forbidden):
        msg = '‚ùå BLOCKED: Forbidden content (emojis/branding)\\n\\n‚úÖ Use ONLY fabric output\\nGenerate: git diff main...HEAD | fabric --pattern pr'

    if msg:
        sys.stderr.write(msg + '\n')
        sys.exit(2)
    sys.exit(0)
    "

_stop_hook_custom_sound: &stop_hook_custom
  event: Stop
  tool: ""
  type: command
  command: "afplay \"$HOME/Jobs Done.mp3\""

_notification_hook: &notification_hook
  event: Notification
  tool: ""
  type: command
  command: "osascript -e 'beep 1'"

# Default configuration (will be overridden based on hostname)
claude_code_advanced_hooks:
  - *git_hook
  - *stop_hook_custom
  - *notification_hook
